05_æ¶ˆæ¯æœºåˆ¶ä¸å¼‚æ­¥ä»»åŠ¡

> ğŸ–Š äººä¸å…‰æ˜¯é ä»–ç”Ÿæ¥å°±æ‹¥æœ‰ä¸€åˆ‡ï¼Œè€Œæ˜¯é ä»–ä»å­¦ä¹ ä¸­æ‰€å¾—åˆ°çš„ä¸€åˆ‡æ¥é€ å°±è‡ªå·±ã€‚ â€”â€” æ­Œå¾·

## ç›¸å…³è¯¾ç¨‹èµ„æ–™ï¼š

> é¼ æ ‡æ”¾ç½®åœ¨æ­£æ–‡å·¦ä¾§ï¼Œç‚¹å‡»â€œ **+** â€å·¥å…·æ ä¸­çš„â€œ **é«˜äº®å—** â€æ¥æ’å…¥é«˜äº®å—ã€‚

ç§‘ç›®ï¼šAndroid

æ—¥æœŸï¼š03/26

ä¸»é¢˜ï¼šå“ç‰Œå®šä½

è¯¾å‰é˜…è¯»ï¼š @ æ’å…¥ç›¸å…³æ–‡æ¡£

## Runnableå¯¹è±¡çš„runï¼ˆï¼‰ä»€ä¹ˆæ—¶å€™åœ¨åˆ†çº¿ç¨‹æ‰§è¡Œï¼Ÿ

å°†runnableä¼ ç»™Threadçš„æ„é€ æ–¹æ³•

```Java
new Thread(new Runnable(){
    public void run(){
        // åœ¨åˆ†çº¿ç¨‹æ‰§è¡Œ
    }
}).start();
```

## æ¶ˆæ¯æœºåˆ¶çš„å¼•å…¥

1. åœ¨Androidä¸­ï¼Œåªæœ‰åœ¨UIThreadä¸­æ‰èƒ½ç›´æ¥æ›´æ–°ç•Œé¢
2. åœ¨Androidä¸­ï¼Œé•¿æ—¶é—´çš„å·¥ä½œï¼ˆè”ç½‘ï¼‰éƒ½éœ€è¦åœ¨workerThreadä¸­æ‰§è¡Œ
3. åœ¨åˆ†çº¿ç¨‹è·å¾—æœåŠ¡å™¨æ•°æ®åï¼Œéœ€è¦ç«‹å³åˆ°ä¸»çº¿ç¨‹å»æ›´æ–°ç•Œé¢æ˜¾ç¤ºæ•°æ®

## å¦‚ä½•å®ç°çº¿ç¨‹é—´é€šä¿¡å‘¢ï¼Ÿ

1. æ¶ˆæ¯æœºåˆ¶ï¼šHandler + Thread
2. å¼‚æ­¥ä»»åŠ¡ï¼š AsyncTask  === Handler + ThreadPool

## Messageçš„ä½¿ç”¨ï¼šçº¿ç¨‹é—´é€šä¿¡çš„æ•°æ®è½½ä½“

1. ### å¯¹è±¡çš„åˆ›å»º

   1. Message.obtainï¼ˆï¼‰  æœ‰å¯èƒ½æ˜¯æ–°å»ºçš„ï¼Œä¹Ÿå¯èƒ½æ˜¯å¤ç”¨çš„æ¶ˆæ¯æ± ä¸­
2. ### å¯¹è±¡çš„ä½¿ç”¨

   1. Int what    æ ‡è¯†
   2. Int args1    ç”¨äºä¿å­˜intæ•°æ®
   3. Int args2    ç”¨äºä¿å­˜intæ•°æ®
   4. Object obj   ç”¨äºä¿å­˜å¯¹è±¡æ•°æ®
   5. Handler target  ä¿å­˜å¤„ç†æ¶ˆæ¯çš„handler
   6. Long when  æ¶ˆæ¯åº”è¯¥è¢«å¤„ç†çš„æ—¶é—´
   7. Message next  æœ‰äº†æ¬¡å±æ€§Messageå°±å¯ä»¥å½¢æˆé˜Ÿåˆ—
   8. Static Message pool  æ¶ˆæ¯æ± ï¼Œç¼“å­˜ç”¨è¿‡çš„æ¶ˆæ¯ç”¨äºå¤ç”¨
   9. Runnable callBack  ç”¨äºå¤„ç†å½“å‰æ¶ˆæ¯çš„å›è°ƒå™¨

## Handlerçš„ä½¿ç”¨ï¼šå‘é€ / å¤„ç† / ç§»é™¤æ¶ˆæ¯

1. ### å¯¹è±¡çš„åˆ›å»ºï¼šnew Handler()
2. ### å¯¹è±¡çš„ä½¿ç”¨ï¼š

   1. #### å‘é€æ¶ˆæ¯

      1. å‘å³æ—¶æ¶ˆæ¯ï¼šsendMessageï¼ˆMessage messageï¼‰
      2. å‘å»¶è¿Ÿæ¶ˆæ¯ï¼šsendMessageDelayedï¼ˆMessage messageï¼Œlong dalayTimeï¼‰
      3. å‘å³æ—¶ç©ºæ¶ˆæ¯ï¼šsendEmptyMessageï¼ˆint whatï¼‰
      4. å‘é€å»¶è¿Ÿç©ºæ¶ˆæ¯ï¼šsendEmptyMessageDelayedï¼ˆint whatï¼Œlong delayTimeï¼‰
   2. #### å¤„ç†æ¶ˆæ¯

      1. Void handleMessageï¼ˆMessage msgï¼‰å›è°ƒæ–¹æ³•
   3. #### ç§»é™¤æ¶ˆæ¯

      1. removeMessageï¼ˆint whatï¼‰ç§»é™¤æœªå¤„ç†çš„æŒ‡å®šwhatçš„message
      2. removeCallbacksAndMessagesï¼ˆnullï¼‰ï¼šç§»é™¤æ‰€æœ‰æœªå¤„ç†çš„æ¶ˆæ¯

## MessageQueueï¼šæ¶ˆæ¯é˜Ÿåˆ—

1. ç”¨æ¥å­˜æ”¾é€šè¿‡Handlerå‘é€çš„æ¶ˆæ¯
2. å®ƒæ˜¯ä¸€ä¸ªæŒ‰Messageçš„whenæ’åºçš„ä¼˜å…ˆçº§é˜Ÿåˆ—

## Looperï¼ˆé’©å­ï¼‰:å¾ªç¯å™¨

1. è´Ÿè´£å¾ªç¯å–å‡ºMessage Queueé‡Œé¢çš„å½“å‰éœ€è¦å¤„ç†çš„Message
2. äº¤ç»™å¯¹åº”çš„Handlerè¿›è¡Œå¤„ç†
3. å¤„å®Œåï¼Œå°†Messageç¼“å­˜åˆ°æ¶ˆæ¯æ± ä¸­ï¼Œä»¥å¤‡å¤ç”¨

## æ¶ˆæ¯æœºåˆ¶çš„åŸç†

![](https://rypnbkno8m.feishu.cn/space/api/box/stream/download/asynccode/?code=YzNjZmMwNDhmMjIyYmU4NzRlMzY5MGJlZGVlOTU0MzlfbDdwOFZjMGJPajlNWlBXRnRyNkJOd3NIQzNpNm9xOU9fVG9rZW46Ym94Y25JZnF0eVRzOEpBaUpxSmJpYU9Ta3RjXzE2NDgzNDYxMDc6MTY0ODM0OTcwN19WNA)

![](https://rypnbkno8m.feishu.cn/space/api/box/stream/download/asynccode/?code=YmZmMTc5YjY4Y2UxNTMxODVjMjE5ODhlOGExZDk2NGVfQUllNUNmVGtVRGl6RDltamVhenZmSFFmNFIxMEtYbXVfVG9rZW46Ym94Y25QR1M3MlpoQVBrYzNFaDRYeTB6bXJmXzE2NDgzNDYxMDc6MTY0ODM0OTcwN19WNA)

## Handlerç”¨äºåšä»€ä¹ˆå·¥ä½œï¼Ÿ

1. çº¿ç¨‹é—´é€šä¿¡ï¼ˆåˆ†çº¿ç¨‹é—´åˆ‡æ¢åˆ°ä¸»çº¿ç¨‹è¿è¡Œï¼‰
2. å»¶è¿Ÿçš„å·¥ä½œ
3. å¾ªç¯å®šæ—¶å·¥ä½œ

## å¼‚æ­¥ä»»åŠ¡AsyncTask

1. #### ä»€ä¹ˆæ˜¯å¼‚æ­¥ä»»åŠ¡ï¼Ÿ

   1. é€»è¾‘ä¸Šï¼šä»¥å¤šçº¿ç¨‹çš„æ–¹å¼å®Œæˆçš„åŠŸèƒ½éœ€æ±‚
   2. APIä¸Šï¼šæŒ‡AsyncTaskç±»
2. #### AsyncTaskçš„ç†è§£

   1. åœ¨æ²¡æœ‰AsyncTaskä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨Handler + Threadå°±å¯ä»¥å®ç°å¼‚æ­¥ä»»åŠ¡çš„åŠŸèƒ½éœ€æ±‚
   2. AsyncTaskæ˜¯å¯¹Handlerå’ŒThreadçš„å°è£…ï¼Œä½¿ç”¨å®ƒæ›´ç¼–ç æ›´ç®€æ´ï¼Œæ›´é«˜æ•ˆ
   3. AsyncTaskå°è£…äº†ThreadPoolï¼Œæ¯”ç›´æ¥ä½¿ç”¨Threadæ•ˆç‡è¦é«˜

![](https://rypnbkno8m.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2UxMGYyNjg5OTUwOGQ0MTJhOGIxYjQ4ZDMwOTQxZTFfMXlGUnd6Y3NMVmFXYXlLdndJcnN0UWo0UXVvbVBIdG9fVG9rZW46Ym94Y25rOFgxWkdtNnpKM0N3UUFOcEZ3ZFBiXzE2NDgzNDYxMDc6MTY0ODM0OTcwN19WNA)

## JSONæ•°æ®æ ¼å¼å’Œè§£æ

1. #### JSONæ˜¯ä»€ä¹ˆï¼Ÿ

   1. æœ‰ç‰¹å®šæ ¼å¼çš„å­—ç¬¦ä¸²
   2. ç”¨äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨çš„æ•°æ®äº¤äº’çš„ä¸€ç§æ•°æ®æ ¼å¼
   3. ä¸XMLæ¯”è¾ƒçš„ä¼˜åŠ¿ï¼Ÿ
      1. å°ã€ç®€æ´
      2. çœæµé‡ã€å“åº”å¿«
2. #### JSONæ•°æ®æ ¼å¼

![](https://rypnbkno8m.feishu.cn/space/api/box/stream/download/asynccode/?code=OGIzNDUwYzY0NzMyMjUxMDUyMGUxOGE1YjRjOGFiZDdfZG9qcXJOZGRvTG9BTnl6cDJ3MldzZzgyTUUyQTE1dUtfVG9rZW46Ym94Y252OFo3MzNsZERWMW5QUGd6REFQV29iXzE2NDgzNDYxMDc6MTY0ODM0OTcwN19WNA)

3. #### å¦‚ä½•è§£æJSONï¼Ÿ

![](https://rypnbkno8m.feishu.cn/space/api/box/stream/download/asynccode/?code=MmM2MTI2Zjk0MTFkNWVlMGMzYzZhYmZjZmYxZGJiNGNfMlJSbXFzcjFTRnV5ZWYweHgwbGFHaWIzWGJXcnZoVGZfVG9rZW46Ym94Y255Z0lyWVNtNjVDNHpnczRFSmo2Y01lXzE2NDgzNDYxMDc6MTY0ODM0OTcwN19WNA)
